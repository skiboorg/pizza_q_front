(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{de12:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{attrs:{padding:""}},[s("div",{staticClass:"container"},[s("p",{staticClass:"text-h5 text-bold"},[t._v("Заказы на "+t._s((new Date).toLocaleDateString()))]),s("q-list",{attrs:{separator:""}},t._l(t.orders,(function(e,a){return s("div",{key:e.id,class:{"bg-grey-2":t.cur_order===a}},[s("q-item",[s("q-item-section",[s("q-item-label",{staticClass:"text-bold",class:{"text-red":e.is_new,"text-green":!e.is_new}},[t._v(" "+t._s(e.is_new?"Новый":"Просмотрен"))]),s("q-item-label",{attrs:{caption:""}},[t._v("Статус")])],1),s("q-item-section",{staticStyle:{"flex-basis":"175px"}},[s("q-item-label",[t._v(" "+t._s(e.cafe_address))]),s("q-item-label",{attrs:{caption:""}},[t._v("Точка выдачи")])],1),s("q-item-section",[s("q-item-label",{staticClass:"text-bold"},[t._v(" "+t._s(e.order_code))]),s("q-item-label",{attrs:{caption:""}},[t._v("Номер заказа")])],1),s("q-item-section",[s("q-item-label",[t._v(" "+t._s(new Date(e.created_at).toLocaleTimeString()))]),s("q-item-label",{attrs:{caption:""}},[t._v("Создан")])],1),s("q-item-section",[s("q-item-label",[t._v(" "+t._s(e.delivery_type))]),s("q-item-label",{attrs:{caption:""}},[t._v("Тип доставки")])],1),s("q-item-section",[s("q-item-label",{},["cash"===e.payment?s("span",[t._v("Наличные")]):t._e(),"online"===e.payment?s("span",[t._v("Онлайн")]):t._e(),"courier_card"===e.payment?s("span",[t._v("Картой курьеру")]):t._e()]),s("q-item-label",{attrs:{caption:""}},[t._v("Тип оплаты")])],1),s("q-item-section",{staticStyle:{display:"none"}},[s("q-item-label",[e.is_payed?s("q-chip",{attrs:{dense:"",color:"green","text-color":"white",icon:"done"}},[t._v("Оплачен")]):s("q-chip",{attrs:{dense:"",color:"red","text-color":"white",icon:"close"}},[t._v("Не оплачен")])],1),s("q-item-label",{attrs:{caption:""}},[t._v("Статус оплаты")])],1),s("q-item-section",[s("q-item-label",{},[t._v(" "+t._s(new Date(e.date).toLocaleDateString())+" / "+t._s(e.time))]),s("q-item-label",{attrs:{caption:""}},[t._v("Дата/Время доставки")])],1),s("q-item-section",{staticStyle:{display:"none"}},[s("q-item-label",[e.status?s("div",[e.status.is_delivered?s("q-chip",{attrs:{dense:"",color:"green","text-color":"white",icon:"done"}},[t._v(t._s(e.status.status))]):e.status.is_delivery_in_progress?s("q-chip",{attrs:{dense:"",color:"warning","text-color":"white",icon:"directions_run"}},[t._v(t._s(e.status.status))]):e.status.is_assing?s("q-chip",{attrs:{dense:"",color:"warning","text-color":"white",icon:"hail"}},[t._v(t._s(e.status.status))]):t._e()],1):s("div",[s("q-chip",{attrs:{dense:"",color:"red","text-color":"white",icon:"close"}},[t._v("Не передан курьеру")])],1)]),s("q-item-label",{attrs:{caption:""}},[t._v("Статус доставки")])],1),s("q-item-section",{attrs:{side:""}},[s("q-item-label",[s("q-item-label",{staticClass:"text-bold text-primary"},[t._v(" "+t._s(e.price)+" руб")])],1),s("q-item-label",{attrs:{caption:""}},[t._v("Сумма заказа")])],1)],1),s("q-item",{staticClass:"items-start"},[s("q-item-section",[s("q-expansion-item",{attrs:{group:"somegroup",label:"Информация о заказе","header-class":"bg-grey-2 text-dark"},on:{click:function(s){return t.openOrder(e.id,a)}}},[s("q-card",[s("q-card-section",{staticClass:"q-pa-md",attrs:{horizontal:""}},[s("div",{staticClass:"col-8"},[s("p",{staticClass:"text-bold q-mb-sm text-primary"},[t._v("Заказчик:")]),s("p",{staticClass:"text-caption q-mb-xs"},[s("span",{staticClass:"text-bold"},[t._v("Телефон")]),t._v(" "+t._s(e.phone)+" "),e.need_callback?s("span",{staticClass:"text-bold text-primary"},[t._v("НУЖНО ПЕРЕЗВОНИТЬ")]):t._e()]),s("p",{staticClass:"text-caption q-mb-xs"},[s("span",{staticClass:"text-bold"},[t._v("ФИО")]),t._v(" "+t._s(e.name))]),s("q-separator",{attrs:{spaced:"sm"}}),s("p",{staticClass:"text-bold q-mb-sm text-primary"},[t._v("Заказ:")]),s("div",{staticClass:"text-caption",domProps:{innerHTML:t._s(e.order_content)}}),s("q-separator",{attrs:{spaced:"sm"}}),s("p",{staticClass:"text-bold q-mb-sm text-primary"},[t._v("Адрес:")]),s("p",{staticClass:"text-caption q-mb-xs"},[s("span",{staticClass:"text-bold"},[t._v("Город")]),t._v(" "+t._s(e.city.name))]),e.street?s("p",{staticClass:"text-caption q-mb-xs"},[s("span",{staticClass:"text-bold"},[t._v("Улица")]),t._v(" "+t._s(e.street))]):t._e(),e.house?s("p",{staticClass:"text-caption q-mb-xs"},[s("span",{staticClass:"text-bold"},[t._v("Дом")]),t._v(" "+t._s(e.house))]):t._e(),e.flat?s("p",{staticClass:"text-caption q-mb-xs"},[s("span",{staticClass:"text-bold"},[t._v("Квартира")]),t._v(" "+t._s(e.flat))]):t._e(),e.podezd?s("p",{staticClass:"text-caption q-mb-xs"},[s("span",{staticClass:"text-bold"},[t._v("Подъезд")]),t._v(" "+t._s(e.podezd))]):t._e(),e.code?s("p",{staticClass:"text-caption q-mb-xs"},[s("span",{staticClass:"text-bold"},[t._v("Код домофона")]),t._v(" "+t._s(e.code))]):t._e(),e.floor?s("p",{staticClass:"text-caption q-mb-xs"},[s("span",{staticClass:"text-bold"},[t._v("Этаж")]),t._v(" "+t._s(e.floor))]):t._e(),e.comment?s("div",[s("q-separator",{attrs:{spaced:"sm"}}),s("p",{staticClass:"text-bold q-mb-sm text-primary"},[t._v("Комментарий:")]),s("p",{staticClass:"q-mb-none text-caption"},[t._v(t._s(e.comment))])],1):t._e()],1),s("q-separator",{attrs:{vertical:""}}),s("div",{staticClass:"col-4  q-pl-md",staticStyle:{display:"none"}},[e.status?s("div",[s("p",{staticClass:"q-mb-sm text-bold"},[t._v("Назначен курьеру")]),s("p",{},[t._v(t._s(e.courier.label))])]):s("div",[s("q-select",{staticClass:"q-mb-sm",attrs:{dense:"",filled:"",options:t.couriers,label:"Курьеры"},model:{value:t.courier,callback:function(e){t.courier=e},expression:"courier"}}),s("q-btn",{staticClass:"q-mb-lg ",attrs:{"no-caps":"",loading:t.is_loading,disable:!t.courier,color:"positive",label:"Назначить заказ"},on:{click:t.assignOrder}})],1),t.courier?s("div",{},[s("p",{staticClass:"q-mb-sm text-bold"},[t._v("Данные о курьере")]),s("p",{staticClass:"q-mb-sm"},[t._v("Телефон: "+t._s(t.courier.phone))]),s("p",[t._v("Назначено заказов: "+t._s(t.courier.orders.length))])]):t._e()])],1)],1)],1)],1)],1),s("q-separator")],1)})),0)],1)])},i=[],r=s("ded3"),o=s.n(r),c=(s("e6cf"),s("ddb0"),s("758b")),l=s("2f62"),n={preFetch({store:t,redirect:e}){t.state.auth.user.is_staff||e({path:"/"})},data(){return{orders:[],couriers:[],cur_order:999,courier:null,intervalID:null,is_loading:!1}},async beforeMount(){await this.getOrders()},mounted(){this.intervalID=setInterval(async function(){await this.getOrders(),this.checkOrders()}.bind(this),5e3)},destroyed(){clearInterval(this.intervalID)},methods:{checkOrders(){let t=new Audio("m.mp3");for(let e of this.orders)if(e.is_new){t.play();break}},async openOrder(t,e){this.cur_order=e,await c["a"].get(`/api/order/set_order_view?id=${t}`),await this.getOrders()},async getOrders(){const t=await c["a"].get(`/api/order/get_orders?city_id=${this.currentCity.id}`);this.orders=t.data},async getCouriers(){const t=await c["a"].get(`/api/courier/all?city_id=${this.currentCity.id}`);this.couriers=t.data},async assignOrder(){this.is_loading=!0,await c["a"].post("/api/courier/assign_order",{order_id:this.orders[this.cur_order].id,courier_id:this.courier.id}),this.is_loading=!1,this.courier=null,await this.getOrders(),await this.getCouriers()}},computed:o()({},Object(l["c"])("city",["cities","currentCity"]))},d=n,_=s("2877"),p=s("9989"),m=s("1c1c"),b=s("66e5"),v=s("4074"),q=s("0170"),u=s("b047"),x=s("3b73"),h=s("f09f"),C=s("a370"),g=s("eb85"),y=s("ddd8"),w=s("9c40"),f=s("eebe"),O=s.n(f),Q=Object(_["a"])(d,a,i,!1,null,null,null);e["default"]=Q.exports;O()(Q,"components",{QPage:p["a"],QList:m["a"],QItem:b["a"],QItemSection:v["a"],QItemLabel:q["a"],QChip:u["a"],QExpansionItem:x["a"],QCard:h["a"],QCardSection:C["a"],QSeparator:g["a"],QSelect:y["a"],QBtn:w["a"]})}}]);